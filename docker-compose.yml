version: '3.8'

services:
  # Flask Application Service with Local Storage
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: b12-app
    ports:
      - "5002:5002"  # Flask application port
    environment:
      # Flask settings
      FLASK_ENV: development
      FLASK_DEBUG: "true"
    volumes:
      # Mount application code for development (hot reload)
      - .:/app
      # Persist stored images on host machine
      - stored_images:/app/stored_images
      # Exclude Python cache and virtual environments
      - /app/__pycache__
      - /app/.venv
    networks:
      - b12-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:5002/health')"]
      interval: 30s
      timeout: 10s
      retries: 3

# Named volumes for data persistence
volumes:
  stored_images:
    driver: local

# Custom network for service communication
networks:
  b12-network:
    driver: bridge